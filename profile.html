<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SignCon - Enjoy Your Contract Journey</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/grayscale.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="dist/css/bc.grid-1.0.0.min.css"/>

    <script src="js/jquery.min.js"></script>
    <script src="dist/bc.grid-1.0.0.min.js"></script>

</head>

<body id="page-top">

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="index.html">星云 SignCon</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="index.html#about">&nbsp关于&nbsp</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="index.html#download">&nbsp创建&nbsp</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="index.html#contact" name="my">&nbsp我的合同&nbsp</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Intro Header -->
<!--<header class="masthead">-->
    <!--<div class="intro-body">-->
        <!--<div class="container">-->
            <!--<div class="row">-->
                <!--<div class="col-lg-8 mx-auto">-->
                    <!--<h1 class="brand-heading">星云 SignCon</h1>-->
                    <!--<p class="intro-text">签约，从未如此简单！-->
                        <!--<br>Make contract signing easy again!</p>-->
                    <!--<a href="#about" class="btn btn-circle js-scroll-trigger">-->
                        <!--<i class="fa fa-angle-double-down animated"></i>-->
                    <!--</a>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
<!--</header>-->

<!-- About Section -->
<!--<section id="about" class="content-section text-center">-->
    <!--<div class="container">-->
        <!--<p>-->
        <!--<h1>关于星云&nbspSingCon</h1>-->
        <!--</p>-->


        <!--<div class="row">-->
            <!--<div class="col-lg-8 mx-auto">-->
                <!--&lt;!&ndash;<h2>About SignCon</h2>&ndash;&gt;-->
                <!--<p>星云 SignCon是一个基于星云链的合同签约平台。</p>-->
                <!--<p>合同数据链上存储，保障了数据公开透明及不可修改等特点。</p>-->
                <!--<p>用户通过SignCon平台进行合同撰写及签约，在家即可完成签约。</p>-->
                <!--<p> 更方便、更简单、更安全！</p>-->
                <!--&lt;!&ndash;<p>This theme features stock photos by&ndash;&gt;-->
                <!--&lt;!&ndash;<a href="http://gratisography.com/">Gratisography</a>&ndash;&gt;-->
                <!--&lt;!&ndash;along with a custom Google Maps skin courtesy of&ndash;&gt;-->
                <!--&lt;!&ndash;<a href="http://snazzymaps.com/">Snazzy Maps</a>.</p>&ndash;&gt;-->
                <!--&lt;!&ndash;<p>Grayscale includes full HTML, CSS, and custom JavaScript files along with SASS and LESS files for easy customization!</p>&ndash;&gt;-->
            <!--</div>-->
        <!--</div>-->

    <!--</div>-->
<!--</section>-->

<!-- Create Section -->
<!--<section id="download" class="download-section content-section text-center">-->
    <!--<div class="container">-->
        <!--<p>-->
        <!--<h1>创建属于你的合同</h1>-->
        <!--</p>-->
        <!--<p>-->
            <!--<button onclick="location.href='create.html'">开始创建</button>-->
        <!--</p>-->
        <!--<p>-->
            <!--<input id="agreedata"> agree</input>-->
        <!--</p>-->
        <!--<p>-->
            <!--<input id="contentdata"> content</input>-->
        <!--</p>-->
        <!--<p>-->
            <!--<button type="button" class="create-contract" name="create-contract">create</button>-->
        <!--</p>-->
        <!--&lt;!&ndash;-->
        <!--<div class="col-lg-8 mx-auto">-->
          <!--<h2>Download Grayscale</h2>-->
          <!--<p>You can download Grayscale for free on the preview page at Start Bootstrap.</p>-->
          <!--<a href="http://startbootstrap.com/template-overviews/grayscale/" class="btn btn-default btn-lg">Visit Download Page</a>-->
        <!--</div>-->
         <!--&ndash;&gt;-->
    <!--</div>-->
<!--</section>-->

<!-- Contact Section -->
<section id="contact" class="content-section text-center">
    <div class="container">
        <div id = "mycontract">
            <p>
            <h1>我的合同</h1>
            </p>
            <!--<p>-->
                <!--<button onclick="location.href='profile.html'">查看我的合同</button>-->
            <!--</p>-->
            <p>
                <button type="button" class="get-contract" name="get-contract">查询我的合同</button>
            </p>

            <p>
                <button type="button" class="sign-contract" name="sign-contract">sign</button>
            </p>
        </div>
        <div>
            <div id="table"></div>
        </div>
        <!--
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Contact Start Bootstrap</h2>
            <p>Feel free to leave us a comment on the
              <a href="http://startbootstrap.com/template-overviews/grayscale/">Grayscale template overview page</a>
              on Start Bootstrap to give some feedback about this theme!</p>
            <ul class="list-inline banner-social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/SBootstrap" class="btn btn-default btn-lg">
                  <i class="fa fa-twitter fa-fw"></i>
                  <span class="network-name">Twitter</span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/BlackrockDigital/startbootstrap" class="btn btn-default btn-lg">
                  <i class="fa fa-github fa-fw"></i>
                  <span class="network-name">Github</span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://plus.google.com/+Startbootstrap/posts" class="btn btn-default btn-lg">
                  <i class="fa fa-google-plus fa-fw"></i>
                  <span class="network-name">Google+</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        -->
    </div>

    <script class="get-contract">
        let data = [{"id":2,"create":"Wang","agree":"Li","createtime":1,"agreetime":"1","content":"139****9517","status":1},
            {"id":2,"create":"Wang","agree":"Li","createtime":1,"agreetime":"1","content":"139****9517","status":0}];
        $(function () {
            var grid=BCGrid.create("#table",{
                columns: [
                    // {id: 'id', name: 'id', display: 'ID', align: 'center', hide: true},
                    {name: 'id',display:'合同编号', render: function(item, index){
                        return item.id.toString().link("https://www.baidu.com")
                        }},
                    {name: 'create',display:'甲方'},
                    {name: 'agree',display:'乙方'},
                    {name: 'createtime',display:'合同创建时间'},
                    {name: 'agreetime',display:'合同生效时间'},
                    {name: 'content',display:'合同内容'},
                    {name: 'status',display:'合同状态', render: function (item, index) {
                        if (item.status == 0) {
                            return "未签约";
                        }
                        else if (item.status == 1) {
                            return "已签约";
                        }
                    }},
                ],
                dataSource:'local',
                localData:data
            });

        });
    </script>


</section>

<!-- Map Section -->
<!--<div id="map"></div>-->

<!-- Footer -->
<footer>
    <div class="container text-center">
        <p>Copyright &copy; 星云 SignCon 2018</p>
    </div>
</footer>

<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Google Maps API Key - Use your own API key to enable the map feature. More information on the Google Maps API can be found at https://developers.google.com/maps/ -->
<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRngKslUGJTlibkQ3FkfTxj3Xss1UlZDA&sensor=false"></script>-->

<!-- Custom scripts for this template -->
<!--<script src="js/grayscale.min.js"></script>-->



<!-- 从这里开始是我添加的代码，你看看注释，然后在网页上试一下，看看我说清楚没 -->

<!-- 和链的链接部分  下面是合约需要的文件，我放在了./lib下面  感觉整体代码有点多，把前端没用的删了就行，靠你了，加油！！！！！先看后面的注释再改-->
<script src="lib/jquery-3.3.1.min.js"></script>
<script src="lib/nebPay.js"></script>
<script src="lib/nebulas.js"></script>

<script type="text/javascript">

    // 合约部分
    var myDate = new Date();
    var NebPay = require("nebpay");
    var nebPay = new NebPay();
    var dappaddress = "n21XsxcfUFvWDQLi6Zp1qwuv2y58mn3ffxk";;;']'

    const mycontractDisplay = document.querySelector(".get-contract");
    // const createcontractDisplay = document.querySelector(".create-contract");
    // const signcontractDisplay = document.querySelector(".sign-contract");

    // 创造合约;
    //这个合约的功能也没有问题，你在页面试一下就知道了，问题还是我弄的页面显示不好看，需要调整
    // function createContract () {
    //
    //     let agree = $("#agreedata").val();
    //     console.log(agree);
    //     let content = $("#contentdata").val();
    //     console.log(content);
    //     let time = myDate.toLocaleString();
    //     console.log(time);
    //
    //     let to = dappaddress;
    //     let value = "0";
    //     //var time = myDate.toLocaleString();
    //     let callFunction = "set";
    //     let callArgs = "[" + "\"" + agree.toString() + "\"" + "," + "\"" + content.toString() + "\"" +  "," + "\"" + time.toString() + "\""+"]";
    //     console.log(callArgs);
    //
    //     nebPay.call(to,value,callFunction,callArgs,{
    //         listener:function(resp){
    //             console.log(resp.result);
    //             let data = JSON.parse(resp.result);
    //             console.log(data);
    //         }
    //     })
    // }

    // 签署合约;
    //这个合约还没有调，这个等你把个人合同的显示和按钮弄好之后我再弄把
    //这样明天就不一定能弄完了，弄不完就下周，尽量做好点拿奖
    function signContract () {

        let time = myDate.toLocaleString();
        //这里id 要获取到 选中的准备签约的合同id,我先舍一个默认值进行测试
        //let id =
        let id = "5";

        let to = dappaddress;
        let value = "0";
        //var time = myDate.toLocaleString();
        let callFunction = "sign";
        let callArgs = "[" + "\"" + id.toString() + "\"" + "," + "\"" + time.toString() + "\"" +"]";

        nebPay.call(to,value,callFunction,callArgs,{
            listener:function(resp){
                console.log(resp.result);
            }
        })
    }

    // 查询个人合约;
    // 这部分的功能没有问题，数据都能返回，就是有点慢，你在页面可以看到，但是需要你把页面显示做的好看一点，
    // 每个合同显示在一个方格或者什么，而且status==0的合约，也就是还没有签署的合约，要有一个签署的按钮;
    function getMyContract () {
        let to = dappaddress;
        let value = "0";
        //var time = myDate.toLocaleString();
        let callsaveFunction = "get";
        let callsaveArgs = "";
        var array=[{"id":2,"create":"Wang","agree":"Li","createtime":1,"agreetime":"1","content":"139****9517","status":1}];
        nebPay.simulateCall(to,value,callsaveFunction,callsaveArgs,{
            listener:function(resp){
                console.log(resp.result.substring(7));
                let data = resp.result.substring(7);
                let contracts = data.split("_value");
                console.log(contracts.length)
                let len = contracts.length;
                for(let i = 0;i < len; i ++){
                    console.log("for-------------")
                    let parts = contracts[i].split(",");
                    let id = parts[0].split(":")[1];
                    console.log(parts.length);
                    console.log(id.toString());
                    let create = parts[1].split(":")[1];
                    console.log(create);
                    let agree = parts[2].split(":")[1];
                    console.log(agree);
                    let createtime = parts[3].split(":")[1];
                    console.log(createtime);
                    let agreetime = parts[4].split(":")[1];
                    console.log(agreetime);
                    let content = parts[5].split(":")[1];
                    // console.log(content);
                    let status = parts[6].split(":")[1];
                    console.log(status);
                    let tmp;
                    $("#mycontract").append("<p>conId:"+id.toString()+"</p>");
                    $("#mycontract").append("<p>create:"+create+"</p>");
                    $("#mycontract").append("<p>agree:"+agree+"</p>");
                    $("#mycontract").append("<p>createtime:"+createtime+"</p>");
                    $("#mycontract").append("<p>agreetime:"+agreetime+"</p>");
                    $("#mycontract").append("<p>content:"+content+"</p>");
                    $("#mycontract").append("<p>status:"+status+"</p>");
                    $("#mycontract").append("<p>\n<p>");
                    tmp = {id:id,create:create,agree:agree,createtime:createtime,agreetime:agreetime,content:content,status:status};
                    // array.push(tmp);





                }
            }
        })
        return array;
    }

    // 查询所有合约;
    //这个合约想了一下应该是没用了，没有必要查看所有的合同，因为不是自己相关的合同，其实不应该有权限查看，所有有上面个人查询的方法就勾，不过先留着吧
    function getaAllContract () {
        let to = dappaddress;
        let value = "0";
        //var time = myDate.toLocaleString();
        let callsaveFunction = "foreach";
        let callsaveArgs = "";

        nebPay.simulateCall(to,value,callsaveFunction,callsaveArgs,{
            listener:function(resp){
                console.log(resp.result);
                let data = JSON.parse(resp.result);
                console.log(data)
            }
        })
    }


    mycontractDisplay.addEventListener("click", getMyContract);
    // createcontractDisplay.addEventListener("click", createContract);
    // signcontractDisplay.addEventListener("click", signContract);

</script>

</body>

</html>